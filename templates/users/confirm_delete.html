{% extends "base.html" %}

{% block title %}Confirm User Deletion{% endblock %}

{% block content %}
<div class="page-header mb-4">
  <h2 class="page-title">Confirm Deletion</h2>
</div>

<div class="card border-warning">
  <div class="card-body">
    <p class="mb-3">
      Are you sure you want to delete user
      <strong>{{ user.get_full_name|default:user.username }}</strong>?
    </p>

    <div class="mb-3 text-muted small">
      <div><strong>Username:</strong> {{ user.username }}</div>
      {% if user.email %}<div><strong>Email:</strong> {{ user.email }}</div>{% endif %}

      {# Avoid hitting user.profile when it may not exist #}
      {% if user.profile_id %}
        {% with p=user.profile %}
          {% if p.phone %}<div><strong>Phone:</strong> {{ p.phone }}</div>{% endif %}
          {% if p.role %}<div><strong>Role:</strong> {{ p.role }}</div>{% endif %}
          {% if p.department %}<div><strong>Department:</strong> {{ p.department }}</div>{% endif %}
        {% endwith %}
      {% endif %}
    </div>

    {% if request.user.pk == user.pk %}
      <div class="alert alert-danger" role="alert">
        You cannot delete your own account.
      </div>
    {% endif %}

    {% if user.is_superuser and not request.user.is_superuser %}
      <div class="alert alert-warning" role="alert">
        Only a superuser can delete another superuser.
      </div>
    {% endif %}

    <form method="post" class="d-flex gap-2" action="">
      {% csrf_token %}
      {# Disable when self-delete OR non-superuser trying to delete superuser #}
      {% if request.user.pk == user.pk or (user.is_superuser and not request.user.is_superuser) %}
        <button type="submit" class="btn btn-danger" disabled aria-disabled="true">
          <i class="fas fa-trash"></i> Yes, delete
        </button>
      {% else %}
        <button type="submit" class="btn btn-danger">
          <i class="fas fa-trash"></i> Yes, delete
        </button>
      {% endif %}
      <a href="{% url 'users:list_users' %}" class="btn btn-secondary">
        Cancel
      </a>
    </form>

    <p class="mt-3 text-muted small">
      Deletion will anonymize the account and deactivate login. Existing task/ticket history is retained.
    </p>
  </div>
</div>
{% endblock %}
