{% extends "base.html" %}
{% block title %}Admin – Reimbursement Bills Summary{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Admin – Bills Summary</h2>
  <div>
    <a href="{% url 'reimbursement:admin_requests' %}" class="btn btn-outline-secondary btn-sm">All Requests</a>
  </div>
</div>

<div class="card">
  <div class="card-header">All reimbursement lines (bills)</div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-sm table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Req ID</th>
            <th>Employee</th>
            <th>Status</th>
            <th>Date</th>
            <th>Category</th>
            <th>Vendor</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Receipt</th>
          </tr>
        </thead>
        <tbody>
          {% for line in lines %}
          <tr>
            <td><a href="{% url 'reimbursement:reimbursement_detail' line.request_id %}">#{{ line.request_id }}</a></td>
            <td>{{ line.request.created_by.get_full_name|default:line.request.created_by.username }}</td>
            <td><span class="badge bg-light text-dark">{{ line.request.get_status_display }}</span></td>
            <td>{{ line.expense_item.date|date:"Y-m-d" }}</td>
            <td>{{ line.expense_item.get_category_display }}</td>
            <td>{{ line.expense_item.vendor|default:"-" }}</td>
            <td class="small">{{ line.description|default:"-" }}</td>
            <td>₹{{ line.amount|floatformat:2 }}</td>
            <td>
              {% if line.receipt_file or line.expense_item.receipt_file %}
                <a href="{% url 'reimbursement:receipt_line' line.id %}" target="_blank" class="btn btn-sm btn-outline-secondary">View</a>
              {% else %}
                <span class="text-muted small">No file</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="9" class="text-center text-muted py-3">No reimbursement lines found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
