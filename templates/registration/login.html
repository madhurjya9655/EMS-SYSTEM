{% extends "base.html" %}
{% load static widget_tweaks %}

{% block title %}Sign In â€” BOS Lakshya{% endblock %}

{% block content %}
<style>
  :root{ --primary:#3b82f6; }

  .auth-wrap{
    min-height: calc(100vh - var(--header-h, 0px));
    display:flex;align-items:center;justify-content:center;
    padding:2rem 1rem;background:#f6f8fb;
  }
  .auth-card{
    width:100%;max-width:980px;border:1px solid #e5e7eb;border-radius:16px;
    overflow:hidden;background:#fff;box-shadow:0 12px 40px rgba(2,6,23,.08);
  }
  .auth-left{
    background: linear-gradient(135deg, var(--primary) 0%, #60a5fa 100%);
    color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;
    padding:2.25rem;gap:1.2rem;position:relative;overflow:hidden;
  }
  .auth-left .brand{display:flex;flex-direction:column;align-items:center;text-align:center;gap:.5rem}
  .auth-left .brand img{height:64px;width:auto;border-radius:10px;display:block}
  .auth-left .brand h2{margin:0;font-weight:800;letter-spacing:.2px;font-size:1.25rem}
  .auth-left .sub{opacity:.95;font-size:.95rem;line-height:1.5;max-width:28ch}

  /* Confetti particles (subtle) */
  .confetti{
    position:absolute; inset:0; pointer-events:none; z-index:0; opacity:.18;
    background-image:
      radial-gradient(2px 2px at 20% 10%, #fff 40%, transparent 41%),
      radial-gradient(2px 2px at 70% 30%, #fff 40%, transparent 41%),
      radial-gradient(2px 2px at 40% 70%, #fff 40%, transparent 41%),
      radial-gradient(2px 2px at 85% 60%, #fff 40%, transparent 41%),
      radial-gradient(2px 2px at 15% 80%, #fff 40%, transparent 41%);
    animation: confettiFloat 18s linear infinite;
  }
  @keyframes confettiFloat{
    0%{ background-position: 0 0, 40px 20px, 80px 40px, 120px 80px, 160px 120px; }
    100%{ background-position: 0 200px, 40px 220px, 80px 240px, 120px 280px, 160px 320px; }
  }

  /* New Year one-line fade carousel below the logo */
  .ny-line-wrap{
    position:relative; z-index:1; width:100%;
    min-height:30px; display:flex; align-items:center; justify-content:center;
    margin-top:.25rem;
  }
  .ny-line{
    position:absolute; opacity:0; transition:opacity .6s ease; font-weight:700;
  }
  .ny-line.is-active{ opacity:1; }
  .ny-dots{ display:flex; gap:.35rem; margin-top:.4rem; }
  .ny-dots span{ width:18px; height:3px; background:rgba(255,255,255,.55); border-radius:6px; }
  .ny-dots span.is-active{ background:#fff; }

  .auth-right{padding:2.25rem 2rem}
  .auth-title{font-weight:800;margin:0 0 .25rem 0;font-size:1.5rem;color:#0f172a}
  .auth-muted{color:#64748b;margin-bottom:1.5rem}
  .form-label{font-weight:600;color:#0f172a}
  .form-control{
    border:1px solid #e5e7eb;border-radius:10px;padding:.75rem .9rem;
    font-size:1rem;transition:border-color .15s, box-shadow .15s;
  }
  .form-control:focus{border-color: var(--primary);box-shadow:0 0 0 .2rem rgba(59,130,246,.15)}
  .input-group .btn{border-color:#e5e7eb;border-left:none;border-radius:0 10px 10px 0}
  .btn-primary{background: var(--primary);border-color: var(--primary);font-weight:700;border-radius:10px;padding:.7rem 1rem}
  .btn-primary:hover{filter:brightness(.95)}
  .auth-meta{display:flex;justify-content:space-between;align-items:center;gap:1rem}

  @media (max-width: 991px){
    .auth-left{display:none}
    .auth-right{padding:2rem}
  }
</style>

<div class="auth-wrap">
  <div class="auth-card">
    <div class="row g-0">
      <!-- Brand side -->
      <div class="col-lg-5 auth-left">
        <div class="confetti" aria-hidden="true"></div>
        <div class="brand">
          <img src="{% static 'images/bos_logo.png' %}" alt="BOS Lakshya Logo">
          <h2>BOS Lakshya</h2>
          <div class="sub">Secure access to your BOS Lakshya dashboard.</div>

          <!-- One-line rotating New Year wishes (no overlap) -->
          <div class="ny-line-wrap" id="nyLineWrap" aria-live="polite">
            <div class="ny-line is-active">Happy New Year 2026 ðŸŽ‰</div>
            <div class="ny-line">Wishing you growth & success!</div>
            <div class="ny-line">Together to new milestones ðŸš€</div>
            <div class="ny-line">Make it count â€” every day âœ¨</div>
          </div>
          <div class="ny-dots" id="nyLineDots" aria-hidden="true"></div>
        </div>
      </div>

      <!-- Form side -->
      <div class="col-lg-7">
        <div class="auth-right">
          <h1 class="auth-title">Welcome Back</h1>
          <div class="auth-muted">Sign in to continue</div>

          <form method="post" novalidate id="loginForm" autocomplete="on">
            {% csrf_token %}
            {% if form.non_field_errors %}
              <div class="alert alert-danger">{{ form.non_field_errors }}</div>
            {% endif %}

            <div class="mb-3">
              <label class="form-label" for="{{ form.username.id_for_label }}">{{ form.username.label }}</label>
              {{ form.username|add_class:"form-control"|attr:"placeholder:Enter your username or email" }}
              {{ form.username.errors }}
            </div>

            <div class="mb-3">
              <label class="form-label" for="{{ form.password.id_for_label }}">{{ form.password.label }}</label>
              <div class="input-group">
                {{ form.password|add_class:"form-control password-input"|attr:"placeholder:Enter your password" }}
                <button type="button" class="btn btn-outline-secondary show-btn" aria-label="Show password">Show</button>
              </div>
              {{ form.password.errors }}
            </div>

            <div class="auth-meta mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="remember" id="remember">
                <label class="form-check-label" for="remember">Remember me</label>
              </div>
              <a href="{% url 'password_reset' %}" class="text-decoration-none">Forgot Password?</a>
            </div>

            <button type="submit" class="btn btn-primary w-100">Sign In</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Toggle show/hide password (accessible)
  document.addEventListener('click', function(e){
    const btn = e.target.closest('.show-btn');
    if(!btn) return;
    const input = btn.closest('.input-group').querySelector('.password-input');
    const isHidden = input.type === 'password';
    input.type = isHidden ? 'text' : 'password';
    btn.textContent = isHidden ? 'Hide' : 'Show';
    btn.setAttribute('aria-label', isHidden ? 'Hide password' : 'Show password');
  });

  // Lightweight one-line fade carousel (no overlap)
  (function(){
    const wrap = document.getElementById('nyLineWrap');
    const dotsWrap = document.getElementById('nyLineDots');
    if(!wrap || !dotsWrap) return;
    const lines = Array.prototype.slice.call(wrap.querySelectorAll('.ny-line'));
    lines.forEach((_l, idx)=>{
      const dot = document.createElement('span');
      if(idx===0) dot.classList.add('is-active');
      dot.addEventListener('click', ()=>{ go(idx); restart(); });
      dotsWrap.appendChild(dot);
    });
    let i=0, timer=null;
    function render(){
      lines.forEach((l,idx)=> l.classList.toggle('is-active', idx===i));
      const dots = dotsWrap.querySelectorAll('span');
      dots.forEach((d,idx)=> d.classList.toggle('is-active', idx===i));
    }
    function next(){ i=(i+1)%lines.length; render(); }
    function go(n){ i=n%lines.length; render(); }
    function restart(){ if(timer) clearInterval(timer); timer=setInterval(next, 3800); }
    render(); restart();
  })();
</script>
{% endblock %}
