{% load static group_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}EMS{% endblock %}</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{% static 'css/custom.css' %}" rel="stylesheet">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --glass-bg: rgba(255,255,255,0.1);
      --glass-border: rgba(255,255,255,0.2);
      --shadow-soft: 0 8px 32px rgba(0,0,0,0.1);
      --shadow-hover: 0 12px 40px rgba(0,0,0,0.15);
      --border-radius: 16px;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      margin: 0;
    }
    .navbar {
      background: var(--primary-gradient) !important;
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-soft);
      border-bottom: 1px solid var(--glass-border);
      z-index: 2000;
    }
    .nav-link, .navbar-brand {
      transition: transform .3s, box-shadow .3s;
    }
    .nav-link:hover, .navbar-brand:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }
    .dropdown-menu {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-soft);
      overflow: visible !important;
      z-index: 3000;
    }
    .dropdown, .navbar-collapse {
      overflow: visible !important;
    }
    .dropdown-item:hover {
      background: var(--secondary-gradient);
      color: #fff !important;
    }
    footer {
      background: rgba(255,255,255,0.9);
      text-align: center;
      padding: 1rem 0;
      margin-top: auto;
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'recruitment:home' %}"><i class="fas fa-cogs"></i> EMS</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav me-auto">

        <li class="nav-item"><a class="nav-link" href="{% url 'recruitment:employee_list' %}"><i class="fas fa-users"></i> Employees</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'recruitment:employee_add' %}"><i class="fas fa-user-plus"></i> Add Employee</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-display="static"><i class="fas fa-calendar-day"></i> Leave</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'leave:my_leaves' %}"><i class="fas fa-file-alt"></i> My Leaves</a></li>
            {% if user|has_group:"Manager" %}<li><a class="dropdown-item" href="{% url 'leave:pending_leaves' %}"><i class="fas fa-check-circle"></i> Manager Approvals</a></li>{% endif %}
            {% if user|has_group:"HR"      %}<li><a class="dropdown-item" href="{% url 'leave:hr_leaves'      %}"><i class="fas fa-user-tie"></i> HR Approvals</a></li>{% endif %}
          </ul>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-display="static"><i class="fas fa-wallet"></i> Petty Cash</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'petty_cash:list_requests'   %}"><i class="fas fa-file-invoice-dollar"></i> My Requests</a></li>
            {% if user|has_group:"Manager" %}<li><a class="dropdown-item" href="{% url 'petty_cash:manager_requests' %}"><i class="fas fa-check"></i> Manager Approvals</a></li>{% endif %}
            {% if user|has_group:"Finance" %}<li><a class="dropdown-item" href="{% url 'petty_cash:finance_requests' %}"><i class="fas fa-coins"></i> Finance Approvals</a></li>{% endif %}
          </ul>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-display="static"><i class="fas fa-chart-line"></i> Sales</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'sales:sales_plan_list'   %}"><i class="fas fa-list"></i> My Plans</a></li>
            <li><a class="dropdown-item" href="{% url 'sales:sales_plan_add'    %}"><i class="fas fa-plus-circle"></i> New Plan</a></li>
            <li><a class="dropdown-item" href="{% url 'sales:sales_dashboard'   %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
          </ul>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-display="static"><i class="fas fa-receipt"></i> Reimbursement</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'reimbursement:my_reimbursements' %}"><i class="fas fa-file-medical"></i> My Requests</a></li>
            {% if user|has_group:"Manager" %}<li><a class="dropdown-item" href="{% url 'reimbursement:manager_pending'   %}"><i class="fas fa-check-square"></i> Manager Approvals</a></li>{% endif %}
            {% if user|has_group:"Finance" %}<li><a class="dropdown-item" href="{% url 'reimbursement:finance_pending'   %}"><i class="fas fa-wallet"></i> Finance Approvals</a></li>{% endif %}
          </ul>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-display="static"><i class="fas fa-tasks"></i> Master Tasks</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'tasks:list_checklist'     %}"><i class="fas fa-clipboard-list"></i> List Checklist</a></li>
            <li><a class="dropdown-item" href="{% url 'tasks:add_checklist'      %}"><i class="fas fa-clipboard-plus"></i> Add Checklist</a></li>
            <li><a class="dropdown-item" href="{% url 'tasks:list_delegation'    %}"><i class="fas fa-user-clock"></i> List Delegation</a></li>
            <li><a class="dropdown-item" href="{% url 'tasks:add_delegation'     %}"><i class="fas fa-user-plus"></i> Add Delegation</a></li>
            <li><a class="dropdown-item" href="{% url 'tasks:bulk_upload'        %}"><i class="fas fa-upload"></i> Bulk Upload</a></li>
          </ul>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-display="static"><i class="fas fa-chart-pie"></i> Reports</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'reports:doer_tasks'           %}"><i class="fas fa-tasks-alt"></i> Doer Tasks</a></li>
            <li><a class="dropdown-item" href="{% url 'reports:weekly_mis_score'    %}"><i class="fas fa-calendar-week"></i> Weekly MIS Score</a></li>
            <li><a class="dropdown-item" href="{% url 'reports:performance_score'  %}"><i class="fas fa-percentage"></i> Performance Score</a></li>
            <li><a class="dropdown-item" href="{% url 'reports:auditor_report'      %}"><i class="fas fa-audit"></i> Auditor Report</a></li>
          </ul>
        </li>

        {% if user.is_superuser %}
        <li class="nav-item">
          <a class="nav-link" data-bs-toggle="collapse" href="#usersSubmenu"><i class="fas fa-user-friends"></i> Users <i class="fas fa-chevron-down"></i></a>
          <div class="collapse ps-3" id="usersSubmenu">
            <a class="nav-link" href="{% url 'users:user_list' %}"><i class="fas fa-list"></i> List Users</a>
            <a class="nav-link" href="{% url 'users:user_add'  %}"><i class="fas fa-user-plus"></i> Add User</a>
          </div>
        </li>
        {% endif %}

      </ul>
      <ul class="navbar-nav">
        {% if user.is_authenticated %}
        <li class="nav-item">
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button class="btn btn-outline-light nav-link"><i class="fas fa-sign-out-alt"></i> Logout</button>
          </form>
        </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<div class="container my-4 flex-grow-1">
  {% block content %}{% endblock %}
</div>

<footer>
  <small>Â© {{ now|date:"Y" }} Developed by Madhurjya Bora</small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
